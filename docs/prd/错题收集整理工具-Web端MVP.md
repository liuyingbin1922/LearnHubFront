# 错题收集整理工具 - Web端MVP PRD

## 产品概述

### 产品背景
学生在学习过程中会产生大量错题，需要一个高效的工具来收集、整理和复习这些错题。传统的手工整理方式耗时费力，且难以系统化管理。本产品旨在通过OCR技术和数字化手段，帮助学生快速建立个人错题库，提高复习效率。

### 产品定位
面向学生群体的错题管理工具，专注于Web端使用，提供从错题收集到导出的完整工作流。

### 目标用户
- 主要用户：中学生、高中生、大学生
- 核心需求：快速录入错题、系统化整理、一键导出复习
- 使用场景：日常学习、考前复习、知识点梳理

## 功能需求

### 功能列表

#### 1. 错题集管理
- 创建错题集（按科目、学期、主题分类）
- 重命名/删除错题集
- 错题集列表展示（名称、题数、更新时间）

#### 2. 错题录入
- 上传题目图片（支持拍照/截图）
- 图片裁剪（前端交互式裁剪）
- OCR文字识别
- OCR结果编辑
- 添加题目备注/错因
- 保存到指定错题集

#### 3. 错题浏览与管理
- 错题集内错题列表展示
- 错题详情查看和编辑
- 题目排序
- 搜索和筛选

#### 4. PDF导出
- 选择错题集导出PDF
- 按题目顺序排版
- 包含题目图片和文字信息

### 功能详情

#### 功能名称：创建错题集
- **功能描述**：用户可以创建不同类别的错题集进行分类管理
- **用户故事**：作为学生，我希望创建"高一数学-函数"错题集，以便按学科和知识点分类管理错题
- **验收标准**：
  - [ ] 可以输入错题集名称
  - [ ] 可以选择预设分类或自定义
  - [ ] 创建后在列表中显示
  - [ ] 支持重命名和删除操作
- **优先级**：P0
- **依赖关系**：无

#### 功能名称：图片上传与裁剪
- **功能描述**：支持上传题目图片，并通过前端交互裁剪出题目区域
- **用户故事**：作为学生，我希望上传数学题目照片并裁剪掉无关背景，以便OCR识别更准确
- **验收标准**：
  - [ ] 支持常见图片格式（JPG、PNG）
  - [ ] 前端裁剪界面直观易用
  - [ ] 裁剪后生成新图片
  - [ ] 支持预览裁剪效果
- **优先级**：P0
- **依赖关系**：错题集创建

#### 功能名称：OCR文字识别
- **功能描述**：对上传的题目图片进行文字识别，提取题目内容
- **用户故事**：作为学生，我希望自动识别图片中的题目文字，以便快速录入而不需要手动输入
- **验收标准**：
  - [ ] 调用OCR服务识别图片文字
  - [ ] 返回识别结果文本
  - [ ] 识别准确率达到可接受水平
  - [ ] 支持中英文混合识别
- **优先级**：P0
- **依赖关系**：图片上传与裁剪

#### 功能名称：OCR结果编辑
- **功能描述**：用户可以对OCR识别的文字进行编辑修正
- **用户故事**：作为学生，我希望编辑OCR识别结果，因为识别可能有误差需要手动修正
- **验收标准**：
  - [ ] 提供文本编辑框
  - [ ] 支持修改识别文字
  - [ ] 保存修改后的文本
  - [ ] 支持撤销操作
- **优先级**：P0
- **依赖关系**：OCR文字识别

#### 功能名称：保存错题
- **功能描述**：将裁剪后的图片、OCR文本和备注保存为一条错题记录
- **用户故事**：作为学生，我希望将题目图片、文字和我的错因分析保存起来，以便日后复习
- **验收标准**：
  - [ ] 关联到指定的错题集
  - [ ] 保存图片、文字、备注信息
  - [ ] 支持添加标签
  - [ ] 生成唯一ID便于管理
- **优先级**：P0
- **依赖关系**：OCR结果编辑

#### 功能名称：PDF导出
- **功能描述**：将错题集导出为PDF文件，方便打印和离线复习
- **用户故事**：作为学生，我希望将错题集导出为PDF打印出来，以便随时随地复习
- **验收标准**：
  - [ ] 选择错题集进行导出
  - [ ] 每题一页或合理排版
  - [ ] 包含题目图片和文字
  - [ ] 包含题号和分类信息
  - [ ] 生成可下载的PDF文件
- **优先级**：P1
- **依赖关系**：保存错题

## 非功能性需求

### 性能要求
- 图片上传响应时间 < 3秒
- OCR识别处理时间 < 10秒
- 页面加载时间 < 2秒
- PDF生成时间 < 30秒（100题以内）

### 安全要求
- 用户图片数据安全存储
- 支持本地存储或云存储加密
- 用户隐私保护

### 兼容性要求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 响应式设计，支持桌面和平板设备
- 图片格式支持：JPG、PNG、WEBP

## 界面设计

### 页面结构
1. **错题集列表页** (`/collections`)
   - 顶部：新建错题集按钮
   - 主体：错题集卡片列表（名称、题数、更新时间、操作）
   - 底部：分页或无限滚动

2. **错题集详情页** (`/collections/:id`)
   - 顶部：错题集信息 + 导出PDF按钮
   - 筛选区：按标签、日期筛选
   - 主体：错题列表（缩略图 + 文字摘要）
   - 右下角：新增错题按钮

3. **新增错题页** (`/collections/:id/new`)
   - 步骤1：上传图片（拖拽或点击上传）
   - 步骤2：裁剪图片（交互式裁剪工具）
   - 步骤3：OCR识别（显示识别进度和结果）
   - 步骤4：编辑信息（OCR文本编辑框 + 备注 + 标签）
   - 底部：保存和取消按钮

4. **错题详情页** (`/problems/:id`)
   - 左侧：题目图片展示
   - 右侧：OCR文字、备注、标签、创建时间
   - 底部：编辑和删除按钮

### 交互流程
```
用户进入 → 创建错题集 → 上传图片 → 裁剪 → OCR识别 → 编辑 → 保存 → 浏览/导出
```

### 状态设计
- **加载状态**：上传中、识别中、生成PDF中
- **空状态**：无错题集、无错题
- **错误状态**：上传失败、识别失败、生成失败

## 技术实现

### 技术栈
- **前端框架**：React 18 + Next.js 14
- **UI组件库**：Tailwind CSS + shadcn/ui
- **图片裁剪**：react-easy-crop
- **状态管理**：React Context / Zustand
- **后端框架**：Next.js API Routes 或 FastAPI (Python)
- **数据库**：SQLite (MVP) / PostgreSQL (生产)
- **对象存储**：本地存储 / MinIO / 云存储
- **OCR服务**：
  - 优先：百度OCR、腾讯OCR、阿里OCR
  - 备选：PaddleOCR (本地部署)
- **PDF生成**：Puppeteer (HTML转PDF)

### 数据结构

#### Collection (错题集)
```sql
CREATE TABLE collections (
  id INTEGER PRIMARY KEY,
  user_id INTEGER DEFAULT 1,
  name TEXT NOT NULL,
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### Problem (错题)
```sql
CREATE TABLE problems (
  id INTEGER PRIMARY KEY,
  collection_id INTEGER NOT NULL,
  original_image_url TEXT,
  cropped_image_url TEXT,
  ocr_text TEXT,
  note TEXT,
  tags TEXT, -- JSON格式
  order_index INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (collection_id) REFERENCES collections(id)
);
```

### API 设计

#### 错题集相关
- `POST /api/collections` - 创建错题集
- `GET /api/collections` - 获取错题集列表
- `GET /api/collections/:id` - 获取错题集详情
- `PUT /api/collections/:id` - 更新错题集
- `DELETE /api/collections/:id` - 删除错题集

#### 图片上传
- `POST /api/upload` - 上传图片（返回URL）

#### OCR识别
- `POST /api/ocr` - OCR识别（入参：image_url或文件）

#### 错题相关
- `POST /api/problems` - 创建错题
- `GET /api/collections/:id/problems` - 获取错题列表
- `GET /api/problems/:id` - 获取错题详情
- `PUT /api/problems/:id` - 更新错题
- `DELETE /api/problems/:id` - 删除错题

#### PDF导出
- `GET /api/collections/:id/export.pdf` - 导出PDF

## 风险评估

### 技术风险
- **OCR准确率**：手写体、公式识别可能不准确
  - 缓解：提供OCR结果编辑功能
  - 考虑：选择准确率更高的云OCR服务
- **PDF生成性能**：大量题目导出耗时
  - 缓解：异步生成，提供进度提示
  - 优化：分批生成、压缩图片

### 业务风险
- **用户接受度**：OCR和手动编辑的流程可能繁琐
  - 缓解：优化UI交互，简化步骤
  - 迭代：根据用户反馈调整流程

### 依赖风险
- **OCR服务稳定性**：依赖第三方云服务
  - 缓解：可切换多个OCR服务提供商
  - 备选：本地OCR方案

## 里程碑规划

### 开发阶段

#### 阶段1：基础框架搭建 (1周)
- [ ] 搭建Next.js项目结构
- [ ] 配置Tailwind CSS和shadcn/ui
- [ ] 设计数据库结构
- [ ] 实现基础页面路由

#### 阶段2：错题集功能 (1周)
- [ ] 错题集CRUD接口
- [ ] 错题集列表页
- [ ] 错题集详情页
- [ ] 错题集创建/编辑/删除

#### 阶段3：图片上传与裁剪 (1周)
- [ ] 图片上传接口
- [ ] 前端上传组件
- [ ] 集成react-easy-crop
- [ ] 裁剪功能实现

#### 阶段4：OCR集成 (1周)
- [ ] 选择并集成OCR服务
- [ ] OCR识别接口
- [ ] OCR结果展示
- [ ] OCR结果编辑功能

#### 阶段5：错题保存与浏览 (1周)
- [ ] 错题CRUD接口
- [ ] 错题保存流程
- [ ] 错题列表展示
- [ ] 错题详情页

#### 阶段6：PDF导出 (1周)
- [ ] PDF模板设计
- [ ] PDF生成接口
- [ ] 前端导出功能
- [ ] 下载和预览

#### 阶段7：测试与优化 (1周)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 界面优化
- [ ] 部署上线

### 测试计划
- **单元测试**：核心业务逻辑
- **集成测试**：用户完整流程
- **性能测试**：OCR和PDF生成性能
- **兼容性测试**：多浏览器兼容

### 上线计划
- **Beta测试**：内部测试和小范围用户测试
- **正式发布**：修复问题后正式上线
- **持续迭代**：收集用户反馈，快速迭代

---

**创建时间**：2026-01-13
**负责人**：产品团队
**版本**：v1.0.0
**状态**：草稿

## 附录

### 用户流程图
```
开始
  ↓
创建/选择错题集
  ↓
上传题目图片
  ↓
裁剪图片（前端）
  ↓
OCR识别（后端）
  ↓
编辑OCR文本
  ↓
添加备注和标签
  ↓
保存错题
  ↓
浏览错题集
  ↓
导出PDF（可选）
  ↓
结束
```

### 核心页面原型说明
1. **极简设计**：减少不必要的装饰，专注功能
2. **操作便捷**：常用功能一键直达
3. **视觉反馈**：每个操作都有明确的成功/失败提示
4. **移动优先**：考虑平板设备的使用场景